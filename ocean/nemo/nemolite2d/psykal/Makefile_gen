# Location of the infrastructure libraries
SHARED_DIR = ../../../../../shared
TIMER_DIR = ${SHARED_DIR}/dl_timer
TIMER_INC = ${TIMER_DIR}/src
TIMER_LIB = ${TIMER_DIR}/dl_timer_lib.a
INF_DIR = ${SHARED_DIR}/dl_esm_inf/finite_difference
INF_INC = ${INF_DIR}/src
FORTCL_INC = ${SHARED_DIR}/dl_esm_inf/external/FortCL/src/
FORTCL_LIB = ${SHARED_DIR}/dl_esm_inf/external/FortCL/src/libFortCL.a
COMMON_DIR = ../../common
COMMON_LIB = ${COMMON_DIR}/nemolite2d_common.a

# It uses its own copy of INF_LIB
INF_LIB=lib_fd.a

# The kernels used by this application and their location
KERNEL_DIR = ../kernels/fortran
KERNELS = boundary_conditions_mod.o \
          continuity_mod.o \
          momentum_mod.o \
          time_update_mod.o \
          infrastructure_mod.o

# Build NemoLite2D
nemolite2d.exe: ${COMMON_LIB} ${KERNELS} psy.o alg.o
	$(F90) $(F90FLAGS) -o $@  ${KERNELS} psy.o alg.o ${COMMON_LIB} ${TIMER_LIB} ${INF_LIB} $(LDFLAGS) ${OMPFLAGS}

# Generic rules
%.o: %.f90
	$(F90) $(F90FLAGS) -I${COMMON_DIR} -I${INF_INC} -I${TIMER_INC} -I${FORTCL_INC} -c $<

%.o: %.F90
	$(F90) $(F90FLAGS) -I${COMMON_DIR} -I${INF_INC} -I${TIMER_INC} -c $<

%.o: %.mod

# If we need a .f90 file that doesn't exist then it must be a kernel.
# Create a link to the required file...
%.f90:
	ln -sf ../../kernels/fortran/$@ .

clean:
	rm -f *.o *.mod *_opt_report.txt
